Testcase                                                                                                                 Result
--------                                                                                                                 ------
[2] su                                                                                                                    PASS 
--- begin output -----------------------------------------------------------
rotate_audit_logs: Attempting to rotate using USR1
+ chmod 666 /tmp/tmp.Cd690BDJjH
+ backup /etc/profile
+ declare f b
+ for f in '"$@"'
++ mktemp /etc/profile.XXXXXX
+ b=/etc/profile.TR0JKM
+ cp -a /etc/profile /etc/profile.TR0JKM
+ prepend_cleanup 'mv -f '\''/etc/profile.TR0JKM'\'' '\''/etc/profile'\'''
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	mv -f '\''/etc/profile.TR0JKM'\'' '\''/etc/profile'\''
	    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ sed -i 's/\[ -w $(tty) \]/false/' /etc/profile
+ export tmp1
++ id -u testuser
+ export TEST_EUID=1004 zero=./test_su.bash
+ TEST_EUID=1004
+ zero=./test_su.bash
++ grep wheel /etc/group
++ cut -d: -f3
+ export WHEEL_GID=10
+ WHEEL_GID=10
+ perl -MPOSIX -e 'setgid $ENV{WHEEL_GID}; setuid $ENV{TEST_EUID}; system $ENV{zero}'
spawn /bin/su - testuser
Password: 
Last login: Thu Jun 24 13:14:55 CEST 2021 from localhost on pts/4
Last failed login: Thu Jun 24 13:14:59 CEST 2021 from localhost on ssh:notty
There was 1 failed login attempt since the last successful login.
nodectl must be run as root!
nodectl must be run as root!
]0;testuser@rhv:~[?1034h[testuser@rhv ~]$ PS1=:\::
]0;testuser@rhv:~:::tty > /tmp/tmp.Cd690BDJjH
]0;testuser@rhv:~:::+ pts=/dev/pts/3
+ pts=3
+ msg_1='acct="*testuser"*[ :]* exe=.*/bin/su.*terminal=pts/3 res=success.*'
+ augrok -q type=USER_AUTH 'msg_1=~PAM:*authentication.* acct="*testuser"*[ :]* exe=.*/bin/su.*terminal=pts/3 res=success.*'
+ augrok -q type=USER_ACCT 'msg_1=~PAM:*accounting.* acct="*testuser"*[ :]* exe=.*/bin/su.*terminal=pts/3 res=success.*'
+ exit_pass
+ [[ -n '' ]]
+ exit 0
+ test_cleanup
+ mv -f /etc/profile.TR0JKM /etc/profile
+ rm -f /tmp/tmp.Cd690BDJjH /tmp/tmp.H1NU0p5xC8 /usr/local/eal4_testing/audit-test/tmp.7Bv9RVbBNj
+ exit
--- end output -------------------------------------------------------------

