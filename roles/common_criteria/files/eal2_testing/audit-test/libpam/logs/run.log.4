Testcase                                                                                                                 Result
--------                                                                                                                 ------
[4] sudo                                                                                                                  PASS 
--- begin output -----------------------------------------------------------
rotate_audit_logs: Attempting to rotate using USR1
+ main
+ setup_cleanup
+ prepend_cleanup 'rm -f /etc/sudoers.new'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	rm -f /etc/sudoers.new
	    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ prepend_cleanup 'groupdel sudogroup'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	groupdel sudogroup
	    rm -f /etc/sudoers.new;
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ prepend_cleanup 'killall -9 -u sudotarget; userdel -rf sudotarget'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	killall -9 -u sudotarget; userdel -rf sudotarget
	    groupdel sudogroup;
    rm -f /etc/sudoers.new;
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ prepend_cleanup 'killall -9 -u sudouser2; userdel -rf sudouser2'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	killall -9 -u sudouser2; userdel -rf sudouser2
	    killall -9 -u sudotarget;
    userdel -rf sudotarget;
    groupdel sudogroup;
    rm -f /etc/sudoers.new;
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ prepend_cleanup 'killall -9 -u sudouser1; userdel -rf sudouser1'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	killall -9 -u sudouser1; userdel -rf sudouser1
	    killall -9 -u sudouser2;
    userdel -rf sudouser2;
    killall -9 -u sudotarget;
    userdel -rf sudotarget;
    groupdel sudogroup;
    rm -f /etc/sudoers.new;
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ gen_user
+ killall -9 -u sudouser1
Cannot find user sudouser1
+ killall -9 -u sudouser2
Cannot find user sudouser2
+ killall -9 -u sudotarget
Cannot find user sudotarget
+ userdel -rf sudouser1
+ userdel -rf sudouser2
+ userdel -rf sudotarget
+ groupdel sudogroup
+ groupadd sudogroup
+ useradd -u 12345 -g sudogroup -p '$6$Rpvtlluu$K63QZN9do4I03/uaKYVFxe3d7CZHOCUsAQNs7F5CQ.b.HJgcGaLOx6qRepDNko4xFxO0VFk4OEQzXHGBAtfHe0' sudouser1
+ useradd -u 12346 -p '$6$Rpvtlluu$K63QZN9do4I03/uaKYVFxe3d7CZHOCUsAQNs7F5CQ.b.HJgcGaLOx6qRepDNko4xFxO0VFk4OEQzXHGBAtfHe0' sudouser2
+ useradd -u 12347 -g sudogroup -p '$6$Rpvtlluu$K63QZN9do4I03/uaKYVFxe3d7CZHOCUsAQNs7F5CQ.b.HJgcGaLOx6qRepDNko4xFxO0VFk4OEQzXHGBAtfHe0' sudotarget
+ backup /etc/sudoers
+ declare f b
+ for f in '"$@"'
++ mktemp /etc/sudoers.XXXXXX
+ b=/etc/sudoers.wJ3Cup
+ cp -a /etc/sudoers /etc/sudoers.wJ3Cup
+ prepend_cleanup 'mv -f '\''/etc/sudoers.wJ3Cup'\'' '\''/etc/sudoers'\'''
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	mv -f '\''/etc/sudoers.wJ3Cup'\'' '\''/etc/sudoers'\''
	    killall -9 -u sudouser1;
    userdel -rf sudouser1;
    killall -9 -u sudouser2;
    userdel -rf sudouser2;
    killall -9 -u sudotarget;
    userdel -rf sudotarget;
    groupdel sudogroup;
    rm -f /etc/sudoers.new;
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ testloop
+ local res=
+ local ret=
+ local testfail=0
+ local testpass=0
+ local testno=0
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_u1'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_u1'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_u1'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_u1'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_u1'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_u1'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_u1'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_u1'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_u1'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser1 sudotarget /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=12347
+ ret=0
+ let testno=0+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test u1 PASSED'
Test u1 PASSED
+ let testpass=0+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_u2'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_u2'
++ USER_EXEC=sudouser2
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_u2'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_u2'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_u2'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_u2'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_u2'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_u2'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_u2'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser1 sudotarget /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser2
+ res=
+ ret=1
+ let testno=1+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test u2 PASSED'
Test u2 PASSED
+ let testpass=1+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_u3'
++ USER_SUDO=%sudogroup
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_u3'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_u3'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_u3'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_u3'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_u3'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_u3'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_u3'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_u3'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers %sudogroup sudotarget /usr/bin/id
+ local User_Alias=%sudogroup
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n %sudogroup ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = %sudogroup'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=12347
+ ret=0
+ let testno=2+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test u3 PASSED'
Test u3 PASSED
+ let testpass=2+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_u4'
++ USER_SUDO=%sudogroup
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_u4'
++ USER_EXEC=sudouser2
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_u4'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_u4'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_u4'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_u4'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_u4'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_u4'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_u4'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers %sudogroup sudotarget /usr/bin/id
+ local User_Alias=%sudogroup
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n %sudogroup ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = %sudogroup'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser2
+ res=
+ ret=1
+ let testno=3+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test u4 PASSED'
Test u4 PASSED
+ let testpass=3+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_t2'
++ USER_SUDO=sudouser2
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_t2'
++ USER_EXEC=sudouser2
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_t2'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_t2'
++ RUN_EXEC=sudouser2
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_t2'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_t2'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_t2'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_t2'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_t2'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser2 sudotarget /usr/bin/id
+ local User_Alias=sudouser2
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser2 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser2'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudouser2 /usr/bin/id -u 2>/dev/null' sudouser2
+ res=
+ ret=1
+ let testno=4+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test t2 PASSED'
Test t2 PASSED
+ let testpass=4+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_t3'
++ USER_SUDO=sudouser2
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_t3'
++ USER_EXEC=sudouser2
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_t3'
++ RUN_SUDO=%sudogroup
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_t3'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_t3'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_t3'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_t3'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_t3'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_t3'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser2 %sudogroup /usr/bin/id
+ local User_Alias=sudouser2
+ local Runas_Alias=%sudogroup
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser2 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser2'
+ echo 'Runas_Alias RUNAS = %sudogroup'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser2
+ res=12347
+ ret=0
+ let testno=5+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test t3 PASSED'
Test t3 PASSED
+ let testpass=5+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_t4'
++ USER_SUDO=sudouser2
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_t4'
++ USER_EXEC=sudouser2
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_t4'
++ RUN_SUDO=%sudogroup
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_t4'
++ RUN_EXEC=sudouser2
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_t4'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_t4'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_t4'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_t4'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_t4'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser2 %sudogroup /usr/bin/id
+ local User_Alias=sudouser2
+ local Runas_Alias=%sudogroup
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser2 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser2'
+ echo 'Runas_Alias RUNAS = %sudogroup'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudouser2 /usr/bin/id -u 2>/dev/null' sudouser2
+ res=
+ ret=1
+ let testno=6+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test t4 PASSED'
Test t4 PASSED
+ let testpass=6+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_c2'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_c2'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_c2'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_c2'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_c2'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_c2'
++ CMD_EXEC=/bin/ls
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_c2'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_c2'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_c2'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser1 sudotarget /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /bin/ls 2>/dev/null' sudouser1
+ res=
+ ret=1
+ let testno=7+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test c2 PASSED'
Test c2 PASSED
+ let testpass=7+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_c3'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_c3'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_c3'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_c3'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_c3'
++ CMD_SUDO=/usr/bin/
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_c3'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_c3'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_c3'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_c3'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser1 sudotarget /usr/bin/
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=12347
+ ret=0
+ let testno=8+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test c3 PASSED'
Test c3 PASSED
+ let testpass=8+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_p2'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_p2'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_p2'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_p2'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_p2'
++ CMD_SUDO=/usr/bin/id
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_p2'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_p2'
++ CMD_RES=
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_p2'
++ CMD_RET=1
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_p2'
++ USER_PASS=wrongpass
+ '[' -z wrongpass ']'
+ setup_sudoers sudouser1 sudotarget /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local Cmd_Alias=/usr/bin/id
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo wrongpass | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=
+ ret=1
+ let testno=9+1
+ '[' '' = '' -a 1 -eq 1 ']'
+ echo 'Test p2 PASSED'
Test p2 PASSED
+ let testpass=9+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_p3'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_p3'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_p3'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_p3'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_p3'
++ CMD_SUDO='NOPASSWD: /usr/bin/id'
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_p3'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_p3'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_p3'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_p3'
++ USER_PASS=
+ '[' -z '' ']'
+ USER_PASS=Tad6osBijy
+ setup_sudoers sudouser1 sudotarget NOPASSWD: /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local 'Cmd_Alias=NOPASSWD: /usr/bin/id'
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) NOPASSWD: /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo Tad6osBijy | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=12347
+ ret=0
+ let testno=10+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test p3 PASSED'
Test p3 PASSED
+ let testpass=10+1
+ for i in '$TESTS'
+ local USER_SUDO=
+ eval 'USER_SUDO=$USER_SUDO_p4'
++ USER_SUDO=sudouser1
+ local USER_EXEC=
+ eval 'USER_EXEC=$USER_EXEC_p4'
++ USER_EXEC=sudouser1
+ local RUN_SUDO=
+ eval 'RUN_SUDO=$RUN_SUDO_p4'
++ RUN_SUDO=sudotarget
+ local RUN_EXEC=
+ eval 'RUN_EXEC=$RUN_EXEC_p4'
++ RUN_EXEC=sudotarget
+ local CMD_SUDO=
+ eval 'CMD_SUDO=$CMD_SUDO_p4'
++ CMD_SUDO='NOPASSWD: /usr/bin/id'
+ local CMD_EXEC=
+ eval 'CMD_EXEC=$CMD_EXEC_p4'
++ CMD_EXEC='/usr/bin/id -u'
+ local CMD_RES=
+ eval 'CMD_RES=$CMD_RES_p4'
++ CMD_RES=12347
+ local CMD_RET=
+ eval 'CMD_RET=$CMD_RET_p4'
++ CMD_RET=0
+ local USER_PASS=
+ eval 'USER_PASS=$USER_PASS_p4'
++ USER_PASS=wrongpass
+ '[' -z wrongpass ']'
+ setup_sudoers sudouser1 sudotarget NOPASSWD: /usr/bin/id
+ local User_Alias=sudouser1
+ local Runas_Alias=sudotarget
+ shift
+ shift
+ local 'Cmd_Alias=NOPASSWD: /usr/bin/id'
+ local perm=
++ stat -c %a /etc/sudoers
+ perm=440
+ perl -ne 'print unless /#SUDO_TESTING_START/../#SUDO_TESTING_END/'
+ sed -e 's/^Defaults    requiretty/# Defaults    requiretty/'
+ '[' -n sudouser1 ']'
+ echo '#SUDO_TESTING_START'
+ echo 'User_Alias USER = sudouser1'
+ echo 'Runas_Alias RUNAS = sudotarget'
+ echo 'Defaults:USER timestamp_timeout=0'
+ echo 'USER  ALL = (RUNAS) NOPASSWD: /usr/bin/id'
+ echo '#SUDO_TESTING_END'
+ mv -f /etc/sudoers.new /etc/sudoers
+ chmod 440 /etc/sudoers
++ su -c 'echo wrongpass | sudo -S -u sudotarget /usr/bin/id -u 2>/dev/null' sudouser1
+ res=12347
+ ret=0
+ let testno=11+1
+ '[' 12347 = 12347 -a 0 -eq 0 ']'
+ echo 'Test p4 PASSED'
Test p4 PASSED
+ let testpass=11+1
+ echo 'Number of tests executed: 12'
Number of tests executed: 12
+ echo 'Number of tests failed:   0'
Number of tests failed:   0
+ echo 'Number of tests passed:   12'
Number of tests passed:   12
+ return 0
+ '[' 0 -gt 0 ']'
+ exit_pass
+ [[ -n '' ]]
+ exit 0
+ test_cleanup
+ mv -f /etc/sudoers.wJ3Cup /etc/sudoers
+ killall -9 -u sudouser1
+ userdel -rf sudouser1
+ killall -9 -u sudouser2
+ userdel -rf sudouser2
+ killall -9 -u sudotarget
+ userdel -rf sudotarget
+ groupdel sudogroup
+ rm -f /etc/sudoers.new
+ rm -f /tmp/tmp.pMVoRw9I49 /tmp/tmp.DkC40W3iVz /usr/local/eal4_testing/audit-test/tmp.TDVWTFjGOH
+ exit
--- end output -------------------------------------------------------------

