Testcase                                                                                                                 Result
--------                                                                                                                 ------
[1] sshd_fail                                                                                                             PASS 
--- begin output -----------------------------------------------------------
rotate_audit_logs: Attempting to rotate using USR1
+ source tp_ssh_functions.bash
++ source functions.bash
+++ [[ -z 1 ]]
+++ return 0
++ BFOLDER=/tmp
++ RND=3685
++ TIMEOUT=600
+ disable_ssh_strong_rng
+ MPROFILE=/etc/profile
+ SSHDCONF=/etc/sysconfig/sshd
+ CCCONF=/etc/profile.d/cc-configuration.sh
+ '[' -e /etc/profile ']'
+ backup /etc/profile
+ declare f b
+ for f in '"$@"'
++ mktemp /etc/profile.XXXXXX
+ b=/etc/profile.FTnUoF
+ cp -a /etc/profile /etc/profile.FTnUoF
+ prepend_cleanup 'mv -f '\''/etc/profile.FTnUoF'\'' '\''/etc/profile'\'''
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	mv -f '\''/etc/profile.FTnUoF'\'' '\''/etc/profile'\''
	    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ '[' -e /etc/sysconfig/sshd ']'
+ backup /etc/sysconfig/sshd
+ declare f b
+ for f in '"$@"'
++ mktemp /etc/sysconfig/sshd.XXXXXX
+ b=/etc/sysconfig/sshd.bGwjqs
+ cp -a /etc/sysconfig/sshd /etc/sysconfig/sshd.bGwjqs
+ prepend_cleanup 'mv -f '\''/etc/sysconfig/sshd.bGwjqs'\'' '\''/etc/sysconfig/sshd'\'''
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	mv -f '\''/etc/sysconfig/sshd.bGwjqs'\'' '\''/etc/sysconfig/sshd'\''
	    mv -f '\''/etc/profile.FTnUoF'\'' '\''/etc/profile'\'';
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ '[' -e /etc/profile.d/cc-configuration.sh ']'
+ ssh_remove_screen /etc/profile
+ '[' x/etc/profile = x ']'
+ '[' -f /etc/profile ']'
+ sed -i 's/.*sleep [0-9]\+.*//g; s/.*exec.*SCREENEXEC.*//g' /etc/profile
+ ssh_restart_daemon
+ '[' capp = lspp ']'
+ service sshd restart
Redirecting to /bin/systemctl restart sshd.service
+ ssh_remove_strong_rng_env
+ export -n SSH_USE_STRONG_RNG
+ prepend_cleanup 'export SSH_USE_STRONG_RNG=12; readonly SSH_USE_STRONG_RNG'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	export SSH_USE_STRONG_RNG=12; readonly SSH_USE_STRONG_RNG
	    mv -f '\''/etc/sysconfig/sshd.bGwjqs'\'' '\''/etc/sysconfig/sshd'\'';
    mv -f '\''/etc/profile.FTnUoF'\'' '\''/etc/profile'\'';
    rm -f "$tmp1" "$tmp2" "$localtmp"
    }'
+ ssh_remove_strong_rng /etc/sysconfig/sshd
+ '[' x/etc/sysconfig/sshd = x ']'
+ '[' -f /etc/sysconfig/sshd ']'
+ sed -i 's/.*SSH_USE_STRONG_RNG.*//g' /etc/sysconfig/sshd
+ ssh_remove_strong_rng /etc/profile.d/cc-configuration.sh
+ '[' x/etc/profile.d/cc-configuration.sh = x ']'
+ '[' -f /etc/profile.d/cc-configuration.sh ']'
+ return
+ ssh_restart_daemon
+ '[' capp = lspp ']'
+ service sshd restart
Redirecting to /bin/systemctl restart sshd.service
+ expect -c '
    spawn ssh testuser@localhost
    expect {
       {continue} {send yes\r; exp_continue}
       {assword} {send badpassword\r}
    }
    expect {
        {permission denied} {close; wait}
        {assword} {close; wait}
    }'
spawn ssh testuser@localhost
testuser@localhost's password: 
Permission denied, please try again.
testuser@localhost's password: + msg_1='acct="*testuser"*[ :]* exe=.*/usr/sbin/sshd.*terminal=ssh res=failed.*'
+ augrok -q type=USER_AUTH 'msg_1=~PAM:*authentication.* acct="*testuser"*[ :]* exe=.*/usr/sbin/sshd.*terminal=ssh res=failed.*'
+ exit_pass
+ [[ -n '' ]]
+ exit 0
+ test_cleanup
+ export SSH_USE_STRONG_RNG=12
+ SSH_USE_STRONG_RNG=12
+ readonly SSH_USE_STRONG_RNG
+ mv -f /etc/sysconfig/sshd.bGwjqs /etc/sysconfig/sshd
+ mv -f /etc/profile.FTnUoF /etc/profile
+ rm -f /tmp/tmp.TrlHoAcGPX /tmp/tmp.0buhtvXJwJ /usr/local/eal4_testing/audit-test/tmp.JtBPRwBMt5
+ exit
--- end output -------------------------------------------------------------

