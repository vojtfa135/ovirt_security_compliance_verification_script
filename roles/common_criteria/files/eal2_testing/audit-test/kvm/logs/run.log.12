Testcase                                                                                      Result
--------                                                                                      ------
[12] test_network_export_source_ip.bash                                                        PASS 
--- begin output -----------------------------------------------------------
Domain KVM-Guest-1 destroyed

Domain KVM-Guest-2 destroyed

Domain KVM-Guest-1 started

Domain KVM-Guest-2 started

+ append_cleanup 'iptables-save | xtables_empty | iptables-restore'
++ type test_cleanup
++ sed '1,3d;$d'
+ eval 'function test_cleanup {
	    rm -f "$tmp1" "$tmp2" "$localtmp"
	iptables-save | xtables_empty | iptables-restore
    }'
++ seq 1 2
+ for i in '$(seq $first $last)'
+ iptables-save
+ xtables_empty
+ iptables-restore
+ sed 's/DROP/ACCEPT/ ; s/\[[0-9]*:[0-9]*\]/\[0:0\]/'
+ grep -e '^\*' -e '^:[^ ]* [^-]' -e '^COMMIT$'
+ eval 'ping -c 5 -I $kvm_guest_1_hostaddr $kvm_guest_1_hostaddr'
++ ping -c 5 -I 192.168.128.1 192.168.128.1
PING 192.168.128.1 (192.168.128.1) from 192.168.128.1 : 56(84) bytes of data.
64 bytes from 192.168.128.1: icmp_seq=1 ttl=64 time=0.080 ms
64 bytes from 192.168.128.1: icmp_seq=2 ttl=64 time=0.073 ms
64 bytes from 192.168.128.1: icmp_seq=3 ttl=64 time=0.066 ms
64 bytes from 192.168.128.1: icmp_seq=4 ttl=64 time=0.029 ms
64 bytes from 192.168.128.1: icmp_seq=5 ttl=64 time=0.082 ms

--- 192.168.128.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 3999ms
rtt min/avg/max/mdev = 0.029/0.066/0.082/0.019 ms
+ [[ 0 -ne 0 ]]
++ seq 1 5
+ for i in '$(seq 1 $kvm_guest_timeout)'
+ eval 'ping -c 5 -I $kvm_guest_1_hostaddr $kvm_guest_1_addr'
++ ping -c 5 -I 192.168.128.1 192.168.128.128
PING 192.168.128.128 (192.168.128.128) from 192.168.128.1 : 56(84) bytes of data.

--- 192.168.128.128 ping statistics ---
5 packets transmitted, 0 received, 100% packet loss, time 4000ms

+ [[ 1 -eq 0 ]]
+ sleep 60
+ for i in '$(seq 1 $kvm_guest_timeout)'
+ eval 'ping -c 5 -I $kvm_guest_2_hostaddr $kvm_guest_2_addr'
++ ping -c 5 -I 192.168.129.1 192.168.129.129
PING 192.168.129.129 (192.168.129.129) from 192.168.129.1 : 56(84) bytes of data.
64 bytes from 192.168.129.129: icmp_seq=1 ttl=64 time=0.243 ms
64 bytes from 192.168.129.129: icmp_seq=2 ttl=64 time=0.133 ms
64 bytes from 192.168.129.129: icmp_seq=3 ttl=64 time=0.150 ms
64 bytes from 192.168.129.129: icmp_seq=4 ttl=64 time=0.122 ms
64 bytes from 192.168.129.129: icmp_seq=5 ttl=64 time=0.173 ms

--- 192.168.129.129 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 3999ms
rtt min/avg/max/mdev = 0.122/0.164/0.243/0.043 ms
+ [[ 0 -eq 0 ]]
+ break
++ tr -cd 0-9A-Za-z
++ head -c 27
+ log_prefix=QrO24SwsvTe11DmR2LZuDPZpo0M
+ eval 'iptables -A INPUT -s $kvm_guest_2_addr -p icmp --icmp-type echo-reply -j LOG --log-level=1 --log-prefix="QrO24SwsvTe11DmR2LZuDPZpo0M: "'
++ iptables -A INPUT -s 192.168.129.129 -p icmp --icmp-type echo-reply -j LOG --log-level=1 '--log-prefix=QrO24SwsvTe11DmR2LZuDPZpo0M: '
+ eval 'iptables -A INPUT -s $kvm_guest_2_addr -p icmp --icmp-type echo-reply -j DROP'
++ iptables -A INPUT -s 192.168.129.129 -p icmp --icmp-type echo-reply -j DROP
+ eval 'ping -c 5 -I $kvm_guest_2_hostaddr $kvm_guest_2_hostaddr'
++ ping -c 5 -I 192.168.129.1 192.168.129.1
PING 192.168.129.1 (192.168.129.1) from 192.168.129.1 : 56(84) bytes of data.
64 bytes from 192.168.129.1: icmp_seq=1 ttl=64 time=0.096 ms
64 bytes from 192.168.129.1: icmp_seq=2 ttl=64 time=0.033 ms
64 bytes from 192.168.129.1: icmp_seq=3 ttl=64 time=0.068 ms
64 bytes from 192.168.129.1: icmp_seq=4 ttl=64 time=0.025 ms
64 bytes from 192.168.129.1: icmp_seq=5 ttl=64 time=0.023 ms

--- 192.168.129.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4000ms
rtt min/avg/max/mdev = 0.023/0.049/0.096/0.028 ms
+ [[ 0 -ne 0 ]]
+ eval 'ping -c 5 -I $kvm_guest_2_hostaddr $kvm_guest_2_addr'
++ ping -c 5 -I 192.168.129.1 192.168.129.129
PING 192.168.129.129 (192.168.129.129) from 192.168.129.1 : 56(84) bytes of data.

--- 192.168.129.129 ping statistics ---
5 packets transmitted, 0 received, 100% packet loss, time 3999ms

+ [[ 1 -eq 0 ]]
++ eval 'grep -c -E "QrO24SwsvTe11DmR2LZuDPZpo0M: .* SRC=$kvm_guest_2_addr" /var/log/messages'
+++ grep -c -E 'QrO24SwsvTe11DmR2LZuDPZpo0M: .* SRC=192.168.129.129' /var/log/messages
+ log_count=5
+ [[ 5 -eq 0 ]]
+ for i in '$(seq $first $last)'
+ iptables-save
+ xtables_empty
+ iptables-restore
+ grep -e '^\*' -e '^:[^ ]* [^-]' -e '^COMMIT$'
+ sed 's/DROP/ACCEPT/ ; s/\[[0-9]*:[0-9]*\]/\[0:0\]/'
+ eval 'ping -c 5 -I $kvm_guest_2_hostaddr $kvm_guest_2_hostaddr'
++ ping -c 5 -I 192.168.129.1 192.168.129.1
PING 192.168.129.1 (192.168.129.1) from 192.168.129.1 : 56(84) bytes of data.
64 bytes from 192.168.129.1: icmp_seq=1 ttl=64 time=0.095 ms
64 bytes from 192.168.129.1: icmp_seq=2 ttl=64 time=0.026 ms
64 bytes from 192.168.129.1: icmp_seq=3 ttl=64 time=0.019 ms
64 bytes from 192.168.129.1: icmp_seq=4 ttl=64 time=0.020 ms
64 bytes from 192.168.129.1: icmp_seq=5 ttl=64 time=0.019 ms

--- 192.168.129.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4000ms
rtt min/avg/max/mdev = 0.019/0.035/0.095/0.030 ms
+ [[ 0 -ne 0 ]]
++ seq 1 5
+ for i in '$(seq 1 $kvm_guest_timeout)'
+ eval 'ping -c 5 -I $kvm_guest_1_hostaddr $kvm_guest_1_addr'
++ ping -c 5 -I 192.168.128.1 192.168.128.128
PING 192.168.128.128 (192.168.128.128) from 192.168.128.1 : 56(84) bytes of data.
64 bytes from 192.168.128.128: icmp_seq=1 ttl=64 time=0.262 ms
64 bytes from 192.168.128.128: icmp_seq=2 ttl=64 time=0.086 ms
64 bytes from 192.168.128.128: icmp_seq=3 ttl=64 time=0.090 ms
64 bytes from 192.168.128.128: icmp_seq=4 ttl=64 time=0.152 ms
64 bytes from 192.168.128.128: icmp_seq=5 ttl=64 time=0.106 ms

--- 192.168.128.128 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4000ms
rtt min/avg/max/mdev = 0.086/0.139/0.262/0.066 ms
+ [[ 0 -eq 0 ]]
+ break
++ tr -cd 0-9A-Za-z
++ head -c 27
+ log_prefix=tRh2vb2rCFXMGkmDG3m68EzcG8H
+ eval 'iptables -A INPUT -s $kvm_guest_1_addr -p icmp --icmp-type echo-reply -j LOG --log-level=1 --log-prefix="tRh2vb2rCFXMGkmDG3m68EzcG8H: "'
++ iptables -A INPUT -s 192.168.128.128 -p icmp --icmp-type echo-reply -j LOG --log-level=1 '--log-prefix=tRh2vb2rCFXMGkmDG3m68EzcG8H: '
+ eval 'iptables -A INPUT -s $kvm_guest_1_addr -p icmp --icmp-type echo-reply -j DROP'
++ iptables -A INPUT -s 192.168.128.128 -p icmp --icmp-type echo-reply -j DROP
+ eval 'ping -c 5 -I $kvm_guest_1_hostaddr $kvm_guest_1_hostaddr'
++ ping -c 5 -I 192.168.128.1 192.168.128.1
PING 192.168.128.1 (192.168.128.1) from 192.168.128.1 : 56(84) bytes of data.
64 bytes from 192.168.128.1: icmp_seq=1 ttl=64 time=0.073 ms
64 bytes from 192.168.128.1: icmp_seq=2 ttl=64 time=0.026 ms
64 bytes from 192.168.128.1: icmp_seq=3 ttl=64 time=0.021 ms
64 bytes from 192.168.128.1: icmp_seq=4 ttl=64 time=0.020 ms
64 bytes from 192.168.128.1: icmp_seq=5 ttl=64 time=0.019 ms

--- 192.168.128.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 3999ms
rtt min/avg/max/mdev = 0.019/0.031/0.073/0.021 ms
+ [[ 0 -ne 0 ]]
+ eval 'ping -c 5 -I $kvm_guest_1_hostaddr $kvm_guest_1_addr'
++ ping -c 5 -I 192.168.128.1 192.168.128.128
PING 192.168.128.128 (192.168.128.128) from 192.168.128.1 : 56(84) bytes of data.

--- 192.168.128.128 ping statistics ---
5 packets transmitted, 0 received, 100% packet loss, time 3999ms

+ [[ 1 -eq 0 ]]
++ eval 'grep -c -E "tRh2vb2rCFXMGkmDG3m68EzcG8H: .* SRC=$kvm_guest_1_addr" /var/log/messages'
+++ grep -c -E 'tRh2vb2rCFXMGkmDG3m68EzcG8H: .* SRC=192.168.128.128' /var/log/messages
+ log_count=5
+ [[ 5 -eq 0 ]]
+ exit_pass
+ [[ -n '' ]]
+ exit 0
+ test_cleanup
+ rm -f /tmp/tmp.u7ROyp21D4 /tmp/tmp.Aj17SwVes0 /usr/local/eal2_testing/audit-test/tmp.vTopSb74HH
+ iptables-save
+ xtables_empty
+ iptables-restore
+ grep -e '^\*' -e '^:[^ ]* [^-]' -e '^COMMIT$'
+ sed 's/DROP/ACCEPT/ ; s/\[[0-9]*:[0-9]*\]/\[0:0\]/'
+ exit
--- end output -------------------------------------------------------------

